<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminMapper">
    <resultMap id="manager" type="com.green.hanbang.admin.vo.MemberManageVO">
        <id column="USER_NO"                 property="userNo"/>
        <result column="USER_NAME"       property="userName"/>
        <result column="PASSWORD"       property="password"/>
        <result column="LOGIN_TYPE"      property="loginType"/>
        <result column="NICK_NAME"      property="nickName"/>
        <result column="PHONE"      property="phone"/>
        <result column="JOIN_DATE"  property="joinDate"/>
        <result column="REALTOR_CODE"  property="realTorCode"/>
        <result column="OFFICE_NAME"  property="officeName"/>
        <result column="IDENTIFICATION_NUM"  property="identificationNum"/>
        <result column="LICENSE_FILE_NAME"  property="licenseFileName"/>
        <result column="AUTHORITY"  property="authority"/>
    </resultMap>
    
    <resultMap id="board" type="com.green.hanbang.admin.vo.BoardVO">
        <result column="BOARD_NUM" property="boardNum"/>
        <result column="INFO_TITLE" property="infoTitle"/>
        <result column="INFO_CONTENT" property="infoContent"/>
        <result column="INFO_REGDATE" property="infoRegDate"/>
    </resultMap>

<!--    일반 회원 조회 -->
    <select id="userManage" resultMap="manager">
        SELECT USER_NO
        , USER_NAME
        FROM MEMBER_USER
        WHERE LOGIN_TYPE = 'USER'
        <if test='userSearch != null and !userSearch.equals("")'>
            AND UPPER(USER_NAME) LIKE '%'||UPPER(#{userSearch})||'%'
        </if>
    </select>

<!--    일반 회원 상세 조회-->
    <select id="userDetail" resultMap="manager">
        SELECT MEM.USER_NO 
            , USER_NAME
            , PASSWORD
            , LOGIN_TYPE
            , NICK_NAME
            , PHONE
            , TO_CHAR(JOIN_DATE, 'YYYY-MM-DD') JOIN_DATE
        FROM MEMBER_USER MEM
        WHERE USER_NO = #{userNo}
    </select>

<!--  일반 회원 삭제 -->
    <delete id="deleteUser">
        DELETE MEMBER_USER
        WHERE USER_NO = #{userNo}
    </delete>

<!--    공인 중개사 조회 -->
    <select id="realManage" resultMap="manager">
        SELECT REALTOR_CODE
            , OFFICE_NAME
            , IDENTIFICATION_NUM
            , AUTHORITY
            , REAL.USER_NO
        FROM MEMBER_USER MEM, REALTOR_DETAIL REAL
        WHERE LOGIN_TYPE = 'REALTOR'
        AND REAL.USER_NO = MEM.USER_NO
        <if test='realSearch != null and !realSearch.equals("")'>
            AND UPPER(IDENTIFICATION_NUM) LIKE '%'||UPPER(#{realSearch})||'%'
        </if>
    </select>

<!-- 공인 중개사 상세 조회-->
    <select id="realDetail" resultMap="manager">
        SELECT REALTOR_CODE
            , OFFICE_NAME
            , IDENTIFICATION_NUM
            , LICENSE_FILE_NAME
            , AUTHORITY
            , USER_NO
            , TO_CHAR(REQUEST_DATE,'YYYY-MM-DD') REQUEST_DATE
        FROM REALTOR_DETAIL
        WHERE IDENTIFICATION_NUM = #{identificationNum}
    </select>

<!-- 공인 중개사 승인 -->
    <update id="updateAuthority">
        UPDATE REALTOR_DETAIL
        SET AUTHORITY = 'Y'
        WHERE EXISTS (SELECT AUTHORITY
                        FROM MEMBER_USER
                        WHERE LOGIN_TYPE = 'REALTOR'
                        AND REALTOR_CODE = #{realTorCode}
                      )

    </update>

<!-- 공인중개사 삭제   -->
    <delete id="deleteReal">
        DELETE REALTOR_DETAIL
        WHERE IDENTIFICATION_NUM = #{identificationNum}
    </delete>

<!--   공지사항 조회하기-->
    <select id="selectBoard" resultMap="board">
        SELECT BOARD_NUM
            , INFO_TITLE
            , TO_CHAR(INFO_REGDATE, 'YYYY-MM-DD') INFO_REGDATE
        FROM INFO_BOARD
        ORDER BY INFO_REGDATE DESC
    </select>

<!-- 공지사항 등록하기 -->
    <insert id="insertBoard" >
        INSERT INTO INFO_BOARD(
            BOARD_NUM
            , INFO_TITLE
            , INFO_CONTENT
        )VALUES (
            (SELECT NVL(MAX(BOARD_NUM),0)+1 FROM INFO_BOARD)
            , #{infoTitle}
            ,#{infoContent}
        )
    </insert>

<!--   공지사항 상세 조회-->
    <select id="detailBoard" resultMap="board">
        SELECT BOARD_NUM
            , INFO_TITLE
            , INFO_CONTENT
            , TO_CHAR(INFO_REGDATE, 'YYYY-MM-DD') INFO_REGDATE
        FROM INFO_BOARD
        WHERE BOARD_NUM = #{boardNum}
    </select>

    <update id="updateBoard">
        UPDATE INFO_BOARD
        SET
            INFO_TITLE = #{infoTitle}
            , INFO_CONTENT= #{infoContent}
        WHERE BOARD_NUM= #{boardNum}
    </update>


    <delete id="deleteBoard">
        DELETE INFO_BOARD
        WHERE BOARD_NUM = #{boardNum}
    </delete>
</mapper>































